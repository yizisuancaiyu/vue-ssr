(this.webpackJsonp=this.webpackJsonp||[]).push([[40],{1105:function(t,e,n){"use strict";var i=n(969);n.n(i).a},1106:function(t,e,n){(t.exports=n(14)(!1)).push([t.i,"\n.gift-box[data-v-03edc1ea] {\n  position: absolute;\n  left: 0;\n  top: 250px;\n  width: 100%;\n  max-height: 260px\n}\n.gift-box.small[data-v-03edc1ea] {\n  top: 84px;\n}\n.gift-box[data-v-03edc1ea] #bigGiftboxInner #giftCanvas {\n        height: 260px;\n}\n.gift-box[data-v-03edc1ea] #bigGiftboxInner .big-gift-title {\n        width: 182px;\n        height: 26px;\n        line-height: 26px;\n        position: relative;\n        border-radius: 26px;\n        overflow: hidden;\n        margin: 0 auto 18px auto;\n        background-image: -webkit-gradient(linear, left top, right top, from(#F0AA21), to(#FF521E));\n        background-image: linear-gradient(90deg, #F0AA21 0%, #FF521E 100%);\n}\n.gift-box[data-v-03edc1ea] #bigGiftboxInner .big-gift-title .user-img {\n          width: 26px;\n          height: 26px;\n          border-radius: 26px;\n          border: 1px solid #EB9D1E;\n          background: #EB9D1E;\n          float: left;\n}\n.gift-box[data-v-03edc1ea] #bigGiftboxInner .big-gift-title .txt {\n          float: left;\n          margin-left: 4px;\n          line-height: 26px;\n}\n.gift-box[data-v-03edc1ea] #bigGiftboxInner .big-gift-title .txt p {\n            float: left;\n            font-size: 12px;\n            color: #FFFFFF;\n            margin-right: 5px\n}\n.gift-box[data-v-03edc1ea] #bigGiftboxInner .big-gift-title .txt p.name {\n  max-width: 60px;\n}\n.gift-box[data-v-03edc1ea] #smallGiftBox {\n      width: 184px;\n      height: 48px;\n      margin: 0 18px 0 14px;\n      padding-left: 20px;\n      position: relative;\n      border-radius: 10px 65px 57px 35px;\n      background-image: -webkit-gradient(linear, left top, right top, from(#F0AA21), to(#FF521E));\n      background-image: linear-gradient(90deg, #F0AA21 0%, #FF521E 100%);\n}\n.gift-box[data-v-03edc1ea] #smallGiftBox .user-img {\n        width: 28px;\n        height: 28px;\n        border-radius: 28px;\n        border: 1px solid #EB9D1E;\n        background: #EB9D1E;\n        position: absolute;\n        left: -13px;\n        top: 0;\n}\n.gift-box[data-v-03edc1ea] #smallGiftBox .txt {\n        width: 100px;\n        max-height: 48px;\n        padding: 4px;\n        float: left;\n        overflow: hidden;\n}\n.gift-box[data-v-03edc1ea] #smallGiftBox .txt p {\n          color: #fff;\n          font-size: 12px;\n          height: 20px;\n          line-height: 20px;\n          overflow: hidden;\n}\n.gift-box[data-v-03edc1ea] #smallGiftBox .gift {\n        position: absolute;\n        left: 130px;\n        top: 4px;\n        width: 170px;\n}\n.gift-box[data-v-03edc1ea] #smallGiftBox .gift .s-gift {\n          width: 40px;\n          height: 40px;\n          float: left;\n}\n.gift-box[data-v-03edc1ea] #smallGiftBox .gift .num {\n          float: left;\n          color: #fff;\n          font-size: 18px;\n          margin-left: 22px;\n          margin-top: 10px;\n}\n.gift-box[data-v-03edc1ea] #smallGiftBox .gift .num img {\n            float: left;\n            height: 24px;\n            margin-right: 1px\n}\n.gift-box[data-v-03edc1ea] #smallGiftBox .gift .num img.x {\n  height: 18px;\n  margin-top: 4px;\n}\n.chat-room[data-v-03edc1ea] {\n  height: 100%;\n  /* position: relative; */\n  /* 针对bos 做界面调整 */\n}\n.chat-room .user-info-box[data-v-03edc1ea] {\n    width: 60%;\n    background: rgba(0, 0, 0, .8);\n    position: absolute;\n    left: 20%;\n    top: 35%;\n    border-radius: 20px;\n    text-align: center;\n}\n.chat-room .user-info-box .info[data-v-03edc1ea] {\n      padding-top: 20px;\n}\n.chat-room .user-info-box .info .user-img[data-v-03edc1ea] {\n        width: 60px;\n        height: 60px;\n        display: block;\n        margin: 0 auto;\n}\n.chat-room .user-info-box .info .name[data-v-03edc1ea] {\n        line-height: 40px;\n        font-size: 14px;\n        color: #fff;\n}\n.chat-room .user-info-box .btn-wrap[data-v-03edc1ea] {\n      border-top: 1px solid #666;\n}\n.chat-room .user-info-box .btn-wrap .btn[data-v-03edc1ea] {\n        color: #fff;\n        font-size: 14px;\n        cursor: pointer;\n        line-height: 40px\n}\n.chat-room .user-info-box .btn-wrap .btn[data-v-03edc1ea]:hover {\n  color: #0D8CFF;\n}\n.chat-room .emoji-top-box[data-v-03edc1ea]{\n     width:334px;\n    border-top:1px solid #F1F1F1;\n    box-sizing: border-box;\n    height:34px;\n}\n.chat-room[data-v-03edc1ea] .ivu-poptip-rel{\n    padding:0 6px;\n    height:34px;\n    line-height:34px\n}\n.chat-room[data-v-03edc1ea] .ivu-poptip-rel:hover {\n  cursor: pointer;\n}\n.chat-room.is-obs[data-v-03edc1ea] {\n  height: 100vh;\n}\n.chat-room.is-obs .top-room[data-v-03edc1ea],\n    .chat-room.is-obs .room-scroll[data-v-03edc1ea] {\n      height: calc(100vh - 115px);\n}\n.chat-room.is-obs .top-room .msg-list.color_black[data-v-03edc1ea], .chat-room.is-obs .room-scroll .msg-list.color_black[data-v-03edc1ea] {\n  color: #fff;\n}\n.chat-room.is-obs .top-room .msg-list.color_orange.is-self[data-v-03edc1ea], .chat-room.is-obs .room-scroll .msg-list.color_orange.is-self[data-v-03edc1ea] {\n  color: #fff;\n}\n.chat-room.is-obs .emoji-top-box[data-v-03edc1ea] {\n      width: 100%;\n      border-color: #333;\n}\n.chat-room.is-obs .emoji-top-box[data-v-03edc1ea] .ivu-poptip-popper {\n        width: 270px;\n}\n.chat-room.is-obs .msg-input-box .input-box[data-v-03edc1ea] {\n        width: calc(100% - 60px);\n}\n.chat-room.is-obs .msg-input-box .input-box textarea[data-v-03edc1ea] {\n          width: 100%;\n}\n.chat-room.is-obs .msg-input-box[data-v-03edc1ea] .ivu-poptip-popper {\n        width: 270px;\n}\n.chat-room .top-room[data-v-03edc1ea] {\n    /* height: 465px; */\n    height:calc(100% - 114px);\n    position: relative;\n}\n.chat-room .room-scroll[data-v-03edc1ea] {\n    /* height: 465px; */\n    height:100%;\n    padding-bottom: 10px;\n    overflow-y: auto;\n}\n.chat-room .room-scroll .sensitive-word[data-v-03edc1ea]{\n      opacity: 0;\n      background: rgba(0, 0, 0, .80);\n      font-family: PingFangSC-Regular;\n      font-size: 16px;\n      color: #FFFFFF;\n      width:295px;\n      padding:20px 0;\n      text-align:center;\n      line-height:22px;\n      position:absolute;\n      left:50%;\n      top:50%;\n      -webkit-transform:translate(-50%);\n              transform:translate(-50%);\n}\n.chat-room[data-v-03edc1ea] .ivu-poptip-body {\n    white-space: normal;\n    word-break: break-all;\n}\n.chat-room[data-v-03edc1ea] .ivu-poptip-body .emoji-mart-category-label {\n      display: none;\n}\n.chat-room .emoji-box[data-v-03edc1ea] {\n    padding: 10px 0;\n}\n.chat-room .msg-input-box[data-v-03edc1ea] {\n    /* height: 44px;\n    line-height: 44px; */\n    height:78px;\n    margin:0 5px 0 6px;\n    overflow: hidden;\n    background: #FFFFFF;\n}\n.chat-room .msg-input-box .ivu-poptip[data-v-03edc1ea] {\n      float: left;\n}\n.chat-room .msg-input-box .child[data-v-03edc1ea] {\n      float: left;\n}\n/* width: 110px; */\n.chat-room .msg-input-box .input-box textarea[data-v-03edc1ea]{\n        width:262px;\n        height:78px;\n        box-sizing:border-box;\n        border:1px solid #F1F1F1;\n        resize:none;\n        line-height:17px;\n        padding:13px 8px;\n        font-szie:12px;\n        color: #999999\n}\n.chat-room .msg-input-box .input-box input[data-v-03edc1ea] {\n        width: 100%;\n        height: 100%;\n        color: #999;\n        line-height: 34px;\n        padding: 5px 10px;\n        background: none;\n        border: none;\n}\n.chat-room .msg-input-box .emoji[data-v-03edc1ea] {\n      width: 50px;\n      float: left;\n      cursor: pointer;\n      text-align: center;\n}\n.chat-room .msg-input-box .emoji .iconfont[data-v-03edc1ea] {\n        color: #666;\n}\n.chat-room .msg-input-box .btn[data-v-03edc1ea] {\n      width: 60px;\n      font-size: 12px;\n      color: #fff;\n      cursor: pointer;\n      text-align: center;\n      line-height:78px;\n      background: #3683ff\n}\n.chat-room .msg-input-box .btn.disabled[data-v-03edc1ea] {\n  cursor: default;\n  background: #CCCCCC;\n}\n.chat-room .msg-list[data-v-03edc1ea] {\n    font-size: 14px;\n    color: #333333;\n    line-height: 22px;\n    padding: 10px 15px 0 15px;\n}\n.chat-room .msg-list .name[data-v-03edc1ea] {\n      color: #0D8CFF;\n      font-size:12px;\n      cursor: pointer;\n}\n.chat-room .msg-list .msg[data-v-03edc1ea] {\n      font-size: 12px;\n      word-break: break-all;\n}\n.chat-room .color_red[data-v-03edc1ea] {\n    color:#E15756;\n}\n.chat-room .color_red .name[data-v-03edc1ea]{\n      color: #E15756;\n}\n.chat-room .color_blue[data-v-03edc1ea] {\n    color:#0D8CFF;\n}\n.chat-room .color_black[data-v-03edc1ea] {\n    color:#333333;\n}\n.chat-room .color_black .name[data-v-03edc1ea]{\n      color:#0D8CFF;\n}\n.chat-room .color_orange[data-v-03edc1ea] {\n    color:#FC8E3E;\n}\n.chat-room .color_orange .name[data-v-03edc1ea]{\n      color:#FC8E3E;\n}\n.chat-room .color_orange.is-self[data-v-03edc1ea] {\n  color:#333333;\n}\n.chat-room .tip[data-v-03edc1ea] {\n    color: #e15756;\n    padding: 15px 15px 0 15px;\n    font-size:12px;\n}\n.chat-room .tip .iconfont[data-v-03edc1ea]{\n      font-size:12px;\n      margin-right:4px;\n}\n",""])},1322:function(t,e,n){var i=n(1998);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,n(15).default)("d4719896",i,!1,{})},1353:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"chat-room",class:{"is-obs":t.isObs}},[n("div",{staticClass:"top-room"},[n("div",{staticClass:"gift-box small",attrs:{id:"sGiftWrap"}}),t._v(" "),n("div",{staticClass:"gift-box",attrs:{id:"bGiftWrap"}}),t._v(" "),t.curSelectUser&&Object.keys(t.curSelectUser).length?n("div",{staticClass:"user-info-box",attrs:{id:"userInfoBox"}},[n("div",{staticClass:"info"},[n("DefaultImg",{staticClass:"user-img",attrs:{src:t.curSelectUser.img,"default-img":t.defaultImg.avatar}}),t._v(" "),n("p",{staticClass:"name"},[t._v("\n          "+t._s(t.curSelectUser.nickName)+"\n        ")])],1),t._v(" "),n("div",{staticClass:"btn-wrap"},[n("div",{staticClass:"btn",on:{click:t.disabledSendMsg}},[t._v("\n          禁言5分钟\n        ")])])]):t._e(),t._v(" "),n("div",{ref:"msgList",staticClass:"room-scroll c-scroll",on:{scroll:t.scroll}},[n("div",{staticClass:"sensitive-word",class:t.isShow},[t._v("\n        "+t._s((t.sensitiveWord||{}).content)+"\n      ")]),t._v(" "),n("div",{ref:"historyList",staticClass:"historyList"},[t._l(t.listItems,function(e,i){return[i>=t.startIndex&&i<=t.endIndex?n("div",{key:i+"_0"},[e.msgType&&5!==e.msgType?n("div",{staticClass:"msg-list",class:t.userType(e)},[n("span",{staticClass:"name",attrs:{"data-show":JSON.stringify(e)}},[t._v(t._s(e.nickName)+"：")]),t._v(" "),n("span",{staticClass:"msg"},[t._v(t._s(e.content))])]):t._e(),t._v(" "),5===e.msgType?n("div",{staticClass:"tip color_red"},[n("i",{staticClass:"iconfont iconicon_massige"}),t._v(t._s(e.content)+"\n            ")]):t._e()]):t._e()]})],2),t._v(" "),t._l(t.liveChatMsg,function(e,i){return n("div",{key:i},[e.msgType&&5!==e.msgType?n("div",{staticClass:"msg-list",class:t.userType(e)},[n("span",{staticClass:"name",attrs:{"data-show":JSON.stringify(e)},on:{click:function(n){return n.stopPropagation(),t.handleUserName(e)}}},[t._v(t._s(e.nickName)+"：")]),t._v(" "),n("span",{staticClass:"msg"},[t._v(t._s(e.content))])]):t._e(),t._v(" "),5===e.msgType?n("div",{staticClass:"tip color_red"},[n("i",{staticClass:"iconfont iconicon_massige"}),t._v(t._s(e.content)+"\n        ")]):t._e()])})],2)]),t._v(" "),n("div",{staticClass:"emoji-top-box"},[n("Poptip",{attrs:{trigger:"hover",theme:"light",placement:"top-end"}},[n("div",{staticClass:"child emoji"},[n("i",{staticClass:"iconfont iconicon_face"})]),t._v(" "),n("div",{staticClass:"emoji-box",attrs:{slot:"content"},slot:"content"},[n("Picker",{attrs:{set:"emojione",emoji:"point_up",include:["people"],"show-search":!1,"infinite-scroll":!1,"show-preview":!1,"show-categories":!1,"emoji-tooltip":!1},on:{select:t.addEmoji}})],1)])],1),t._v(" "),n("div",{staticClass:"msg-input-box"},[n("div",{staticClass:"child input-box"},[n("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.message,expression:"message",modifiers:{trim:!0}}],attrs:{type:"text",placeholder:"我也来说几句",maxlength:"30"},domProps:{value:t.message},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.submit(e))},input:function(e){e.target.composing||(t.message=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})]),t._v(" "),n("div",{staticClass:"child btn",class:{disabled:!t.message},on:{click:t.submit}},[t._v("\n      发送\n    ")])])])};i._withStripped=!0;n(33),n(26),n(11),n(44);var o=n(4),s=n.n(o),a=(n(263),n(18)),r=n(38),c=n(1359),d=n(264),l=n(429),h={components:{Poptip:r.Poptip,Picker:c.Picker},props:{matchData:{type:Object,default:function(){return{}}},sensitiveWord:{type:Object,default:function(){}},isObs:{type:Boolean,default:!1},anchorId:{type:Number,default:0}},data:function(){return{message:"",mqtt:null,query:{},msgList:[],comeInText:"进入直播间，和大家打个招呼吧",sessionId:"",time:0,sendNum:0,setIntervalTime:null,isShow:"",startIndex:"",listItems:[],deleteLong:100,currentLong:400,historyLong:1e4,timeout:null,historyHeight:0,autoBottom:!0,timeoutStartindexChange:null,curSelectUser:null}},computed:s()({userType:function(){return function(t){return 2==t.msgType?"color_orange":t.userId==this.anchorId?t.userId==this.getUserInfo().uid?"color_orange is-self":"color_blue":t.userId==this.getUserInfo().uid?"color_orange is-self":"color_black"}}},Object(a.mapGetters)(["liveChatMsg"]),{endIndex:function(){return this.listItems.length-1}}),watch:{sensitiveWord:function(t){var e=this;t&&Object.keys(t).length&&(this.isShow="animated fadeIn",Object(l.setTimeout)(function(){e.isShow="animated fadeOut",e.$emit("initSensitive")},2e3))},liveChatMsg:function(t){t.length==this.currentLong&&(this.listItems.length<this.historyLong&&(this.listItems=this.listItems.concat(t.slice(0,this.deleteLong))),this.setLiveChatMstShift(this.deleteLong)),this.autoBottom&&this.scrollChat(t)},listItems:function(t,e){t.length>=this.historyLong&&(this.listItems=this.listItems.slice(t.length-this.historyLong)),this.startIndex&&this.startIndex!==e.length-1?this.startIndex=this.startIndex:this.startIndex=t.length-1},startIndex:function(t,e){this.initTime()}},mounted:function(){var t=this;this.init(),document.onclick=function(e){var n=document.getElementById("userInfoBox");n&&!n.contains(e.target)&&(t.curSelectUser={})}},methods:s()({initTime:function(){var t=this;this.timeoutStartindexChange&&window.clearTimeout(this.timeoutStartindexChange),this.timeoutStartindexChange=window.setTimeout(function(){t.autoBottom=!0},6e4)},scroll:function(){this.$refs.msgList.scrollTop<this.historyScrollTop&&(this.autoBottom=!1),this.debounces(function(){var t=this;this.$refs.msgList.scrollTop<30&&0!=this.listItems.length?(this.startIndex=this.startIndex-20<0?0:this.startIndex-20,this.$nextTick(function(){t.$refs.msgList.scrollTop=t.$refs.historyList.offsetHeight-t.historyHeight,t.historyHeight=t.$refs.historyList.offsetHeight})):this.$refs.msgList.scrollTop>this.$refs.msgList.scrollHeight-this.$refs.msgList.offsetHeight-40&&(this.startIndex=this.endIndex>=0?this.endIndex:0,this.autoBottom=!0,this.historyHeight=0)},200)},debounces:function(t,e){var n=this;this.timeout&&window.clearTimeout(this.timeout),this.timeout=window.setTimeout(function(){t.apply(n)},e)},init:function(){this.getParams(),this.query.roomId?this.sessionId="live_"+this.query.roomId:this.sessionId="match_"+this.query.id,this.mqtt=new d.a},scrollChat:function(t){var e=this;t&&this.$nextTick(function(){e.$refs.msgList.scrollTop=e.$refs.msgList.scrollHeight,e.historyScrollTop=e.$refs.msgList.scrollTop,e.startIndex=e.endIndex})},getParams:function(){this.query=this.$route.query||{}},addEmoji:function(t){this.message+=t.native},sendChat:function(t){var e=this.mqtt.sendMessage(this.sessionId,t);200===e.code&&99!==e.msgType&&(this.message="")},submit:function(){var t=localStorage.getItem("userInfo");if(this.message)if(localStorage.getItem("token")&&t&&"{}"!==t)if(this.setIntervalTime||(this.setIntervalTime=window.setInterval(this.addTime,1e3)),this.sendNum+=1,this.time<10&&this.sendNum<4){var e={fontColor:"#333333",nickName:this.commUserInfo.nickName||"访客",sessionId:this.sessionId,userId:this.commUserInfo.uid,userLevel:this.commUserInfo.userLevel||1,avatar:this.commUserInfo.img,userType:this.commMemberInfo.vip?this.commMemberInfo.vip.level:""};this.sendChat(s()({},e,{content:this.message,msgType:1}))}else this.$tip("亲你说话的速度太快了");else this.G_SetLogin(!0)},addTime:function(){this.time+=1,10===this.time&&(this.time=0,this.sendNum=0,this.setIntervalTime&&(window.clearInterval(this.setIntervalTime),this.setIntervalTime=null))}},Object(a.mapMutations)(["setLiveChatMstShift"]),{handleUserName:function(t){var e="roomUserType_"+this.query.roomId+"_"+this.commUserInfo.uid;sessionStorage.getItem(e)&&(this.curSelectUser=t)},disabledSendMsg:function(){var t=this;this.$post("v2.1/roommanager/keepslient",{apiType:"anchor",body:{roommanager_uid:this.commUserInfo.uid,uid:this.curSelectUser.userId,room_id:this.$route.query.roomId,type:1,keep_time:300}}).then(function(e){var n=e.code,i=e.msg;t.$judgeCode(n)?(t.curSelectUser={},t.$success("禁言成功")):t.$error(i)}).catch(function(){t.$error("服务器出错")})}})},m=(n(1105),n(6)),p=Object(m.a)(h,i,[],!1,null,"03edc1ea",null);p.options.__file="src/project/pc/www/pages/live/components/chat-room.vue";e.a=p.exports},1997:function(t,e,n){"use strict";var i=n(1322);n.n(i).a},1998:function(t,e,n){(t.exports=n(14)(!1)).push([t.i,"\n.obs-chat[data-v-370998f8] {\n  width: 100vw;\n  background: #000;\n}\n",""])},2119:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"obs-chat"},[this.anchorId?e("ChatRoom",{attrs:{"is-obs":!0,"anchor-id":this.anchorId}}):this._e()],1)};i._withStripped=!0;var o=n(1353),s=n(264),a={components:{ChatRoom:o.a},data:function(){return{mqtt:null,subscribePath:null,anchorId:""}},mounted:function(){alert("1-mounted"),this.obsInit(),this.init()},destroyed:function(){this.mqtt.unsubscribe(this.subscribePath)},methods:{init:function(){alert("3-init"),this.getParams(),document.body.style.minWidth="0px",document.getElementsByClassName("app-main")[0].style.minHeight="0px",alert("4-startObsInit"),window.startObsInit=function(t,e){localStorage.getItem("token")&&localStorage.getItem("userInfo")||t&&e&&(localStorage.setItem("token",t),localStorage.setItem("userInfo",e),window.location.reload())},alert("5-开始调onObsWebInitFinish"),window.channelChatRoom.onObsWebInitFinish();var t=localStorage.getItem("userInfo");t&&(this.G_SetUserInfo(JSON.parse(t)),this.anchorId=JSON.parse(t).uid),this.query.roomId?this.subscribePath="live_"+this.query.roomId:this.subscribePath="match_"+this.query.id,this.setMqtt()},obsInit:function(){alert("2-obsInit"),new QWebChannel(qt.webChannelTransport,function(t){window.channelChatRoom=t.objects.chatRoom})},getParams:function(){this.query=this.$route.query||{}},setMqtt:function(){this.mqtt=new s.a(this.getMessage),this.mqtt.subscribe(this.subscribePath)},getMessage:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("100403"===e.type&&e.msg){var n=JSON.parse(e.msg);if(n.send_uid===this.commUserInfo.uid)return;1==n.gift_type_id?(this.$store.commit("addSmallGifts",n),this.startSmallGift()):(this.$store.commit("addBigGifts",n),this.startBigGift())}e.content&&-1!==t.indexOf(this.subscribePath)&&(this.$store.commit("setLiveChatMsg",e),99!==e.msgType&&this.$store.commit("addBarrageMsg",e))}}},r=(n(1997),n(6)),c=Object(r.a)(a,i,[],!1,null,"370998f8",null);c.options.__file="src/project/pc/www/pages/live/obs-chat.vue";e.default=c.exports},969:function(t,e,n){var i=n(1106);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,n(15).default)("54847067",i,!1,{})}}]);